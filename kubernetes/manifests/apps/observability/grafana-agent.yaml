---
helm:
  path: ./kubernetes/templates/grafanaagent

dependsOn:
  - name: observability-grafana-agent-operator

values:
  metrics:
    endpoint: https://mimir.k3pi.xyz
  logs:
    endpoint: https://loki.k3pi.xyz
  additionalScrapeConfigs:
    - job_name: ash-nazg-telegraf
      scrape_interval: 60s
      static_configs:
        - targets:
            - 192.168.0.1:9273
      relabel_configs:
      - action: hashmod
        modulus: $(SHARDS)
        source_labels:
        - __address__
        target_label: __tmp_hash
      - action: keep
        regex: $(SHARD)
        source_labels:
        - __tmp_hash
        
    - job_name: narya-node
      scrape_interval: 60s
      static_configs:
        - targets:
            - narya.${SECRET_INTERNAL_DOMAIN}:9100
      relabel_configs:
      - action: hashmod
        modulus: $(SHARDS)
        source_labels:
        - __address__
        target_label: __tmp_hash
      - action: keep
        regex: $(SHARD)
        source_labels:
        - __tmp_hash
        
    - job_name: zigbeemqtt-node
      scrape_interval: 60s
      static_configs:
        - targets:
            - zigbeemqtt.${SECRET_INTERNAL_DOMAIN}:9100
      relabel_configs:
      - action: hashmod
        modulus: $(SHARDS)
        source_labels:
        - __address__
        target_label: __tmp_hash
      - action: keep
        regex: $(SHARD)
        source_labels:
        - __tmp_hash
        
    - job_name: zigbeemqtt-mqtt
      scrape_interval: 60s
      static_configs:
        - targets:
            - zigbeemqtt.${SECRET_INTERNAL_DOMAIN}:9641
      relabel_configs:
      - action: hashmod
        modulus: $(SHARDS)
        source_labels:
        - __address__
        target_label: __tmp_hash
      - action: keep
        regex: $(SHARD)
        source_labels:
        - __tmp_hash

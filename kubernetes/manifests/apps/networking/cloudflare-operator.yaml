---
kustomize:
  - https://github.com/adyanth/cloudflare-operator/config/default?ref=v0.10.1

resources:
  - apiVersion: v1
    kind: Secret
    metadata:
      name: cloudflare-secrets
    stringData:
      CLOUDFLARE_API_KEY: "${SECRET_CLOUDFLARED_KEY}"
      CLOUDFLARE_API_TOKEN: "${SECRET_CLOUDFLARED_TOKEN}"

  - apiVersion: networking.cfargotunnel.com/v1alpha1
    kind: TunnelBinding
    metadata:
      name: flux-receiver
    subjects:
      - name: flux-receiver
    tunnelRef:
      kind: ClusterTunnel
      name: vilya-torech

  - apiVersion: networking.cfargotunnel.com/v1alpha1
    kind: ClusterTunnel
    metadata:
      name: vilya-torech
    spec:
      newTunnel:
        name: vilya-torech
      size: 1
      cloudflare:
        email: "${SECRET_EMAIL}"
        domain: "flux-webhook.${SECRET_DEV_DOMAIN}"
        secret: cloudflare-secrets
        accountId: "${SECRET_CLOUDFLARED_ACCOUNTID}"

---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.name }}-restic-config
  namespace: {{ .Values.namespace }}
type: Opaque
stringData:
  RESTIC_REPOSITORY: "${RESTIC_REPOSITORY}/{{ .Values.namespace }}/{{ .Values.name }}"
  RESTIC_PASSWORD: "${RESTIC_PASSWORD}"
  AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_RESTIC}"
  AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_KEY_RESTIC}"
----
apiVersion: volsync.backube/v1alpha1
kind: ReplicationSource
metadata:
  name: {{ .Values.name }}
  namespace: {{ .Values.namespace }}
spec:
  sourcePVC: {{ .Values.pvc }}
  trigger:
    schedule: {{ .Values.schedule }}
  restic:
    pruneIntervalDays: {{ .Values.retentionDays }}
    repository: "${RESTIC_REPOSITORY}/{{ .Values.namespace }}/{{ .Values.name }}"
    retain:
      daily: {{ .Values.retentionDays }}
    copyMethod: Snapshot
